{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-10">
        <h2>Admin Panel - Comprehensive Team Statistics</h2>
        <p class="text-muted">Click column headers to sort</p>
            <div class="mb-3">
                <a href="/add_game" class="btn btn-sm btn-primary">Add Game</a>
                <button class="btn btn-sm btn-success ms-2" data-bs-toggle="modal" data-bs-target="#snapshotModal">ðŸ“¸ Create Snapshot</button>
                {% if historical_rankings|length >= 2 %}
                    <a href="{{ url_for('historical_rankings') }}" class="btn btn-sm btn-info ms-2">ðŸ“ˆ View Historical</a>
                {% endif %}
            </div>
        <div class="table-responsive">
            <table class="table table-striped table-sm" id="statsTable">
                <thead>
                    <tr>
                        <th class="sortable-header" onclick="sortTable(0, true)">Rank<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(1)">Team<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(2)">Conf<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(3, true)">PF<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(4, true)">PA<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(5, true)">MoV<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(6, true)">PD<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(7, true)">HW<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(8, true)">RW<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(9, true)">P4W<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(10, true)">G5W<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(11, true)">Opp W<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(12, true)">Opp L<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(13, true)">SoS<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(14, true)">Opp W/L Diff<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(15, true)">Totals<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(16, true)">Total W<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(17, true)">Total L<span class="sort-indicator"></span></th>
                        <th class="sortable-header" onclick="sortTable(18, true)">Adj Total<span class="sort-indicator">â†“</span></th>
                    </tr>
                </thead>
                <tbody>
                    {% for team in comprehensive_stats %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td style="white-space: nowrap; min-width: 120px;">
    {% set logo_url = get_team_logo_url(team.team) %}
    {% if logo_url %}
        <img src="{{ logo_url }}" alt="{{ team.team }}" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
    {% endif %}
    <a href="{{ url_for('team_detail', team_name=team.team) }}">{{ team.team }}</a>
</td>
                        <td>
                            {% set badge_class = {
                                'ACC': 'primary', 'Big Ten': 'success', 'Big XII': 'warning text-dark',
                                'Pac 12': 'info', 'SEC': 'danger', 'Independent': 'secondary',
                                'American': 'dark', 'Conference USA': 'light text-dark',
                                'MAC': 'primary', 'Mountain West': 'success', 'Sun Belt': 'warning text-dark'
                            }.get(team.conference, 'secondary') %}
                            <span class="badge bg-{{ badge_class }}">{{ team.conference }}</span>
                        </td>
                        <td>{{ team.points_fielded }}</td>
                        <td>{{ team.points_allowed }}</td>
                        <td>{{ team.margin_of_victory }}</td>
                        <td>{{ team.point_differential }}</td>
                        <td>{{ team.home_wins }}</td>
                        <td>{{ team.road_wins }}</td>
                        <td>{{ team.p4_wins }}</td>
                        <td>{{ team.g5_wins }}</td>
                        <td>{{ team.opp_w }}</td>
                        <td>{{ team.opp_l }}</td>
                        <td>{{ team.strength_of_schedule }}</td>
                        <td>{{ team.opp_wl_differential }}</td>
                        <td><strong>{{ team.totals }}</strong></td>
                        <td>{{ team.total_wins }}</td>
                        <td>{{ team.total_losses }}</td>
                        <td class="text-primary"><strong>{{ team.adjusted_total }}</strong></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="col-md-2">
        <h6>Recent Games</h6>
        {% if recent_games %}
            <div class="list-group">
                {% for game in recent_games[:5] %}
                <div class="list-group-item p-2">
                    <small class="text-muted">Week {{ game.week }}</small><br>
                    <small class="fw-bold">{{ game.home_team }} {{ game.home_score }}-{{ game.away_score }} {{ game.away_team }}</small>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-muted small">No games yet.</p>
        {% endif %}
    </div>
</div>
<!-- Snapshot Modal -->
<div class="modal fade" id="snapshotModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create Weekly Snapshot</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('create_snapshot') }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="week_name" class="form-label">Snapshot Name</label>
                        <input type="text" class="form-control" id="week_name" name="week_name" 
                               value="Week {{ historical_rankings|length + 1 }}" required>
                        <div class="form-text">Give this snapshot a descriptive name (e.g., "Week 3", "After Bowl Games")</div>
                    </div>
                    <div class="alert alert-info">
                        <small>This will save the current rankings so you can track changes over time.</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">ðŸ“¸ Create Snapshot</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}